

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>skyllh.core.utils package &mdash; SkyLLH  documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="skyllh.datasets package" href="skyllh.datasets.html" />
    <link rel="prev" title="skyllh.core.minimizers package" href="skyllh.core.minimizers.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            SkyLLH
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../concepts/index.html">Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq/index.html">Frequently Ask Questions (FAQ)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="skyllh.html">skyllh package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="skyllh.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="skyllh.analyses.html">skyllh.analyses package</a></li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.cluster.html">skyllh.cluster package</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="skyllh.core.html">skyllh.core package</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="skyllh.core.html#subpackages">Subpackages</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.analysis">skyllh.core.analysis module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.background_generation">skyllh.core.background_generation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.background_generator">skyllh.core.background_generator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.backgroundpdf">skyllh.core.backgroundpdf module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.binning">skyllh.core.binning module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.catalog">skyllh.core.catalog module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.config">skyllh.core.config module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.datafields">skyllh.core.datafields module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.dataset">skyllh.core.dataset module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.debugging">skyllh.core.debugging module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.detsigyield">skyllh.core.detsigyield module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.display">skyllh.core.display module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.event_selection">skyllh.core.event_selection module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.expectation_maximization">skyllh.core.expectation_maximization module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.flux_model">skyllh.core.flux_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.interpolate">skyllh.core.interpolate module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.livetime">skyllh.core.livetime module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.llhratio">skyllh.core.llhratio module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.math">skyllh.core.math module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.minimizer">skyllh.core.minimizer module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.model">skyllh.core.model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.multiproc">skyllh.core.multiproc module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.parameters">skyllh.core.parameters module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.pdf">skyllh.core.pdf module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.pdfratio">skyllh.core.pdfratio module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.pdfratio_fill">skyllh.core.pdfratio_fill module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.progressbar">skyllh.core.progressbar module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.py">skyllh.core.py module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.random">skyllh.core.random module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.scrambling">skyllh.core.scrambling module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.services">skyllh.core.services module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.session">skyllh.core.session module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.sidereal_time">skyllh.core.sidereal_time module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.signal_generation">skyllh.core.signal_generation module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.signal_generator">skyllh.core.signal_generator module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.signalpdf">skyllh.core.signalpdf module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.smoothing">skyllh.core.smoothing module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.source_hypo_grouping">skyllh.core.source_hypo_grouping module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.source_model">skyllh.core.source_model module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.storage">skyllh.core.storage module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.test_statistic">skyllh.core.test_statistic module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.times">skyllh.core.times module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.timing">skyllh.core.timing module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.tool">skyllh.core.tool module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.trialdata">skyllh.core.trialdata module</a></li>
<li class="toctree-l4"><a class="reference internal" href="skyllh.core.html#module-skyllh.core.types">skyllh.core.types module</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.datasets.html">skyllh.datasets package</a></li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.i3.html">skyllh.i3 package</a></li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.p1.html">skyllh.p1 package</a></li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.plotting.html">skyllh.plotting package</a></li>
<li class="toctree-l3"><a class="reference internal" href="skyllh.scripting.html">skyllh.scripting package</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../notes.html">Notes</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dev_docs/unit_tests.html">Unit tests</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">SkyLLH</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="skyllh.html">skyllh package</a></li>
          <li class="breadcrumb-item"><a href="skyllh.core.html">skyllh.core package</a></li>
      <li class="breadcrumb-item active">skyllh.core.utils package</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/reference/skyllh.core.utils.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-skyllh.core.utils">
<span id="skyllh-core-utils-package"></span><h1>skyllh.core.utils package<a class="headerlink" href="#module-skyllh.core.utils" title="Link to this heading"></a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Link to this heading"></a></h2>
</section>
<section id="module-skyllh.core.utils.analysis">
<span id="skyllh-core-utils-analysis-module"></span><h2>skyllh.core.utils.analysis module<a class="headerlink" href="#module-skyllh.core.utils.analysis" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.get_bkg_event_prob_func">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">get_bkg_event_prob_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bkg_event_rate_field_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.get_bkg_event_prob_func" title="Link to this definition"></a></dt>
<dd><p>Returns a function with call signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="fm">__call__</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p>that calculates the background event probabilities given a sequence of data
field names which contain different background data rates. All rates will be
added.</p>
<p>The returned function can be used for example for the
<a class="reference internal" href="skyllh.core.html#skyllh.core.background_generation.MCDataSamplingBkgGenMethod" title="skyllh.core.background_generation.MCDataSamplingBkgGenMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">skyllh.core.background_generation.MCDataSamplingBkgGenMethod</span></code></a> class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>bkg_event_rate_field_names</strong> (<em>sequence</em><em> of </em><em>str</em>) – The sequence of data field names containing background event rates.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>bkg_event_prob_func</strong> (<em>callable</em>) – The function that calculates the background event probabilities.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.get_bkg_mean_func">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">get_bkg_mean_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">bkg_event_rate_field_names</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.get_bkg_mean_func" title="Link to this definition"></a></dt>
<dd><p>Returns a function with call signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="fm">__call__</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">events</span><span class="p">)</span>
</pre></div>
</div>
<p>that calculates the mean number of background events for a dataset given a
sequence of data field names which contain different background data rates
in Hz. All rates will be added.</p>
<p>The returned function can be used for example for the
<a class="reference internal" href="skyllh.core.html#skyllh.core.background_generation.MCDataSamplingBkgGenMethod" title="skyllh.core.background_generation.MCDataSamplingBkgGenMethod"><code class="xref py py-class docutils literal notranslate"><span class="pre">skyllh.core.background_generation.MCDataSamplingBkgGenMethod</span></code></a> class.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>bkg_event_rate_field_names</strong> (<em>sequence</em><em> of </em><em>str</em>) – The sequence of data field names containing background event rates in
Hz.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>bkg_mean_func</strong> (<em>callable</em>) – The function that calculates the mean number of background events.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.pointlikesource_to_data_field_array">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">pointlikesource_to_data_field_array</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">tdm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">shg_mgr</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pmm</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.pointlikesource_to_data_field_array" title="Link to this definition"></a></dt>
<dd><p>Function to transform a list of PointLikeSource sources into a numpy
record ndarray. The resulting numpy record ndarray contains the following
fields:</p>
<blockquote>
<div><dl class="simple">
<dt><cite>ra</cite>: float</dt><dd><p>The right-ascention of the point-like source.</p>
</dd>
<dt><cite>dec</cite>: float</dt><dd><p>The declination of the point-like source.</p>
</dd>
<dt><cite>weight</cite>: float</dt><dd><p>The weight of the point-like source.</p>
</dd>
</dl>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>tdm</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.trialdata.TrialDataManager" title="skyllh.core.trialdata.TrialDataManager"><em>TrialDataManager</em></a>) – The TrialDataManager instance.</p></li>
<li><p><strong>shg_mgr</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.source_hypo_grouping.SourceHypoGroupManager" title="skyllh.core.source_hypo_grouping.SourceHypoGroupManager"><em>SourceHypoGroupManager</em></a>) – The instance of SourceHypoGroupManager that defines the sources.</p></li>
<li><p><strong>pmm</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.parameters.ParameterModelMapper" title="skyllh.core.parameters.ParameterModelMapper"><em>ParameterModelMapper</em></a>) – The instance of ParameterModelMapper that defines the mapping of global
parameters to local model parameters.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>arr</strong> (<em>(N_sources,)-shaped numpy record ndarray</em>) – The numpy record ndarray holding the source parameters.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.calculate_pval_from_trials">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">calculate_pval_from_trials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts_vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comp_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'greater'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.calculate_pval_from_trials" title="Link to this definition"></a></dt>
<dd><p>Calculates the percentage (p-value) of test-statistic trials that are
above the given test-statistic critical value.
In addition it calculates the standard deviation of the p-value assuming
binomial statistics.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts_vals</strong> (<em>(</em><em>n_trials</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em><em> of </em><em>float</em>) – The ndarray holding the test-statistic values of the trials.</p></li>
<li><p><strong>ts_threshold</strong> (<em>float</em>) – The critical test-statistic value.</p></li>
<li><p><strong>comp_operator</strong> (<em>string</em><em>, </em><em>optional</em>) – The comparison operator for p-value calculation. It can be set to one of
the following options: ‘greater’ or ‘greater_equal’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>p, p_sigma</strong> (<em>tuple(float, float)</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.calculate_pval_from_gammafit_to_trials">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">calculate_pval_from_gammafit_to_trials</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts_vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">500000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.calculate_pval_from_gammafit_to_trials" title="Link to this definition"></a></dt>
<dd><p>Calculates the probability (p-value) of test-statistic exceeding
the given test-statistic threshold. This calculation relies on fitting
a gamma distribution to a list of ts values.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts_vals</strong> (<em>(</em><em>n_trials</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em><em> of </em><em>float</em>) – The ndarray holding the test-statistic values of the trials.</p></li>
<li><p><strong>ts_threshold</strong> (<em>float</em>) – The critical test-statistic value.</p></li>
<li><p><strong>eta</strong> (<em>float</em><em>, </em><em>optional</em>) – Test-statistic value at which the gamma function is truncated
from below. Default = 3.0.</p></li>
<li><p><strong>n_max</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of trials that should be used during
fitting. Default = 500,000</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>p, p_sigma</strong> (<em>tuple(float, float)</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.calculate_pval_from_trials_mixed">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">calculate_pval_from_trials_mixed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts_vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">switch_at_ts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_max</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">500000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comp_operator</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'greater_equal'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.calculate_pval_from_trials_mixed" title="Link to this definition"></a></dt>
<dd><p>Calculates the probability (p-value) of test-statistic exceeding
the given test-statistic threshold. This calculation relies on fitting
a gamma distribution to a list of ts values if ts_threshold is larger than
switch_at_ts. If ts_threshold is smaller then the pvalue will be taken
from the trials directly.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts_vals</strong> (<em>(</em><em>n_trials</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em><em> of </em><em>float</em>) – The ndarray holding the test-statistic values of the trials.</p></li>
<li><p><strong>ts_threshold</strong> (<em>float</em>) – The critical test-statistic value.</p></li>
<li><p><strong>switch_at_ts</strong> (<em>float</em><em>, </em><em>optional</em>) – Test-statistic value below which p-value is computed from trials
directly. For thresholds greater than switch_at_ts the pvalue is
calculated using a gamma fit.</p></li>
<li><p><strong>eta</strong> (<em>float</em><em>, </em><em>optional</em>) – Test-statistic value at which the gamma function is truncated
from below. Default is None.</p></li>
<li><p><strong>n_max</strong> (<em>int</em><em>, </em><em>optional</em>) – The maximum number of trials that should be used during
fitting. Default = 500,000</p></li>
<li><p><strong>comp_operator</strong> (<em>string</em><em>, </em><em>optional</em>) – The comparison operator for p-value calculation. It can be set to one of
the following options: ‘greater’ or ‘greater_equal’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>p, p_sigma</strong> (<em>tuple(float, float)</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.truncated_gamma_logpdf">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">truncated_gamma_logpdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">a</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ts_above_eta</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_above_eta</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.truncated_gamma_logpdf" title="Link to this definition"></a></dt>
<dd><p>Calculates the -log(likelihood) of a sample of random numbers
generated from a gamma pdf truncated from below at x=eta.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>a</strong> (<em>float</em>) – Shape parameter.</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – Scale parameter.</p></li>
<li><p><strong>eta</strong> (<em>float</em>) – Test-statistic value at which the gamma function is truncated
from below.</p></li>
<li><p><strong>ts_above_eta</strong> (<em>(</em><em>n_trials</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em>) – The ndarray holding the test-statistic values falling in
the truncated gamma pdf.</p></li>
<li><p><strong>N_above_eta</strong> (<em>int</em>) – Number of test-statistic values falling in the truncated
gamma pdf.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>-logl</strong> (<em>float</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.calculate_critical_ts_from_gamma">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">calculate_critical_ts_from_gamma</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_quantile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eta</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">3.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.calculate_critical_ts_from_gamma" title="Link to this definition"></a></dt>
<dd><p>Calculates the critical test-statistic value corresponding
to h0_ts_quantile by fitting the ts distribution with a truncated
gamma function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ts</strong> (<em>(</em><em>n_trials</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em>) – The ndarray holding the test-statistic values of the trials.</p></li>
<li><p><strong>h0_ts_quantile</strong> (<em>float</em>) – Null-hypothesis test statistic quantile.</p></li>
<li><p><strong>eta</strong> (<em>float</em><em>, </em><em>optional</em>) – Test-statistic value at which the gamma function is truncated
from below.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>critical_ts</strong> (<em>float</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.polynomial_fit">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">polynomial_fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ns</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_weight</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deg</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p_thr</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.polynomial_fit" title="Link to this definition"></a></dt>
<dd><p>Performs a polynomial fit on the p-values of test-statistic trials
associated to each ns..
Using the fitted parameters it computes the number of signal events
correponding to the given p-value critical value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ns</strong> (<em>1D array_like object</em>) – x-coordinates of the sample.</p></li>
<li><p><strong>p</strong> (<em>1D array_like object</em>) – y-coordinates of the sample.</p></li>
<li><p><strong>p_weight</strong> (<em>1D array_like object</em>) – Weights to apply to the y-coordinates of the sample points. For gaussian
uncertainties, use 1/sigma.</p></li>
<li><p><strong>deg</strong> (<em>int</em>) – Degree of the fitting polynomial function.</p></li>
<li><p><strong>p_thr</strong> (<em>float within</em><em> [</em><em>0</em><em>,</em><em>1</em><em>]</em>) – The critical p-value.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>ns</strong> (<em>float</em>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.estimate_mean_nsignal_for_ts_quantile">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">estimate_mean_nsignal_for_ts_quantile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">critical_ts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_quantile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_dmu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.estimate_mean_nsignal_for_ts_quantile" title="Link to this definition"></a></dt>
<dd><p>Calculates the mean number of signal events needed to be injected to
reach a test statistic distribution with defined properties for the given
analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<em>Analysis instance</em>) – The Analysis instance to use for the calculation.</p></li>
<li><p><strong>rss</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random numbers.</p></li>
<li><p><strong>p</strong> (<em>float</em>) – Desired probability of signal test statistic for exceeding
<cite>h0_ts_quantile</cite> part of null-hypothesis test statistic threshold.</p></li>
<li><p><strong>eps_p</strong> (<em>float</em>) – Precision in <cite>p</cite> as stopping condition for the calculation.</p></li>
<li><p><strong>mu_range</strong> (<em>2-element sequence</em>) – The range of mu (lower,upper) to search for mean number of signal
events.</p></li>
<li><p><strong>critical_ts</strong> (<em>float</em><em> | </em><em>None</em>) – The critical test-statistic value that should be overcome by the signal
distribution. If set to None, the null-hypothesis test-statistic
distribution will be used to compute the critical TS value.</p></li>
<li><p><strong>h0_trials</strong> (<em>(</em><em>n_h0_trials</em><em>,</em><em>)</em><em>-shaped ndarray</em><em> | </em><em>None</em>) – The structured ndarray holding the trials for the null-hypothesis.
If set to <cite>None</cite>, the number of trials is calculated
from binomial statistics via <cite>h0_ts_quantile*(1-h0_ts_quantile)/eps**2</cite>,
where <cite>eps</cite> is <cite>min(5e-3, h0_ts_quantile/10)</cite>.</p></li>
<li><p><strong>h0_ts_quantile</strong> (<em>float</em><em> | </em><em>None</em>) – Null-hypothesis test statistic quantile.
If set to None, the critical test-statistic value that should be
overcome by the signal distribution MUST be given.</p></li>
<li><p><strong>min_dmu</strong> (<em>float</em>) – The minimum delta mu to use for calculating the derivative dmu/dp.
The default is <code class="docutils literal notranslate"><span class="pre">0.5</span></code>.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>. If <cite>poisson</cite> is set to True, the actual number of
generated signal events will be drawn from a Poisson distribution
with the mean number of signal events, mu.</p></li>
<li><p><strong>ppbar</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.progressbar.ProgressBar" title="skyllh.core.progressbar.ProgressBar"><em>ProgressBar</em></a><em> | </em><em>None</em>) – The possible parent ProgressBar instance.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional TimeLord instance that should be used to collect timing
information about this function.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em><em> | </em><em>None</em>) – Trial data file path including the filename.
If set to None, generatedtrials won’t be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mu</strong> (<em>float</em>) – Estimated mean number of signal events.</p></li>
<li><p><strong>mu_err</strong> (<em>None</em>) – Error estimate needs to be implemented.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.estimate_sensitivity">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">estimate_sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_quantile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.9</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_dmu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.estimate_sensitivity" title="Link to this definition"></a></dt>
<dd><p>Estimates the mean number of signal events that whould have to be
injected into the data such that the test-statistic value of p*100% of all
trials are larger than the critical test-statistic value c, which
corresponds to the test-statistic value where h0_ts_quantile*100% of all
null hypothesis test-statistic values are larger than c.</p>
<p>For sensitivity h0_ts_quantile, and p are usually set to 0.5, and 0.9,
respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for sensitivity estimation.</p></li>
<li><p><strong>rss</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random
numbers.</p></li>
<li><p><strong>h0_trials</strong> (<em>(</em><em>n_h0_ts_vals</em><em>,</em><em>)</em><em>-shaped ndarray</em><em> | </em><em>None</em>) – The strutured ndarray holding the trials for the null-hypothesis.
If set to <cite>None</cite>, the number of trials is calculated from binomial
statistics via <cite>h0_ts_quantile*(1-h0_ts_quantile)/eps**2</cite>,
where <cite>eps</cite> is <cite>min(5e-3, h0_ts_quantile/10)</cite>.</p></li>
<li><p><strong>h0_ts_quantile</strong> (<em>float</em><em>, </em><em>optional</em>) – Null-hypothesis test statistic quantile that defines the critical value.</p></li>
<li><p><strong>p</strong> (<em>float</em><em>, </em><em>optional</em>) – Desired probability of the signal test statistic value to exceed
the null-hypothesis test statistic value threshold, which is defined
through the <cite>h0_ts_quantile</cite> value.</p></li>
<li><p><strong>eps_p</strong> (<em>float</em><em>, </em><em>optional</em>) – Precision in <cite>p</cite> for execution to break.</p></li>
<li><p><strong>mu_range</strong> (<em>2-element sequence</em><em> | </em><em>None</em>) – Range to search for the mean number of signal events.
If set to None, the range (0, 10) will be used.</p></li>
<li><p><strong>min_dmu</strong> (<em>float</em>) – The minimum delta mu to use for calculating the derivative dmu/dp.
The default is <code class="docutils literal notranslate"><span class="pre">0.5</span></code>.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>. If <cite>poisson</cite> is set to True, the actual number of
generated signal events will be drawn from a Poisson distribution
with the mean number of signal events, mu.</p></li>
<li><p><strong>ppbar</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.progressbar.ProgressBar" title="skyllh.core.progressbar.ProgressBar"><em>ProgressBar</em></a><em> | </em><em>None</em>) – The possible parent ProgressBar instance.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional TimeLord instance that should be used to collect timing
information about this function.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em><em> | </em><em>None</em>) – Trial data file path including the filename.
If set to None, generated trials won’t be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mu</strong> (<em>float</em>) – Estimated median number of signal events to reach desired sensitivity.</p></li>
<li><p><strong>mu_err</strong> (<em>float</em>) – The uncertainty of the estimated mean number of signal events.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.estimate_discovery_potential">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">estimate_discovery_potential</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_trials</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_quantile</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2.8665e-07</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_p</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.005</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_range</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_dmu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.estimate_discovery_potential" title="Link to this definition"></a></dt>
<dd><p>Estimates the mean number of signal events that whould have to be
injected into the data such that the test-statistic value of p*100% of all
trials are larger than the critical test-statistic value c, which
corresponds to the test-statistic value where h0_ts_quantile*100% of all
null hypothesis test-statistic values are larger than c.</p>
<p>For the 5 sigma discovery potential <cite>h0_ts_quantile</cite>, and <cite>p</cite> are usually
set to 2.8665e-7, and 0.5, respectively.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for discovery potential estimation.</p></li>
<li><p><strong>rss</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random
numbers.</p></li>
<li><p><strong>h0_trials</strong> (<em>(</em><em>n_h0_ts_vals</em><em>,</em><em>)</em><em>-shaped ndarray</em><em> | </em><em>None</em>) – The structured ndarray holding the trials for the null-hypothesis.
If set to <cite>None</cite>, the number of trials is calculated from binomial
statistics via <cite>h0_ts_quantile*(1-h0_ts_quantile)/eps**2</cite>,
where <cite>eps</cite> is <cite>min(5e-3, h0_ts_quantile/10)</cite>.</p></li>
<li><p><strong>h0_ts_quantile</strong> (<em>float</em><em>, </em><em>optional</em>) – Null-hypothesis test statistic quantile that defines the critical value.</p></li>
<li><p><strong>p</strong> (<em>float</em><em>, </em><em>optional</em>) – Desired probability of the signal test statistic value to exceed the
critical value.</p></li>
<li><p><strong>eps_p</strong> (<em>float</em><em>, </em><em>optional</em>) – Precision in <cite>p</cite> for execution to break.</p></li>
<li><p><strong>mu_range</strong> (<em>2-element sequence</em><em> | </em><em>None</em>) – Range to search for the mean number of signal events.
If set to None, the range (0, 10) will be used.</p></li>
<li><p><strong>min_dmu</strong> (<em>float</em>) – The minimum delta mu to use for calculating the derivative dmu/dp.
The default is <code class="docutils literal notranslate"><span class="pre">0.5</span></code>.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>. If <cite>poisson</cite> is set to True, the actual number of
generated signal events will be drawn from a Poisson distribution
with the mean number of signal events, mu.</p></li>
<li><p><strong>ppbar</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.progressbar.ProgressBar" title="skyllh.core.progressbar.ProgressBar"><em>ProgressBar</em></a><em> | </em><em>None</em>) – The possible parent ProgressBar instance.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional TimeLord instance that should be used to collect timing
information about this function.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em><em> | </em><em>None</em>) – Trial data file path including the filename.
If set to None, generated trials won’t be saved.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mu</strong> (<em>float</em>) – Estimated mean number of injected signal events to reach the desired
discovery potential.</p></li>
<li><p><strong>mu_err</strong> (<em>float</em>) – Estimated error of <cite>mu</cite>.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.generate_mu_of_p_spline_interpolation">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">generate_mu_of_p_spline_interpolation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_vals</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">h0_ts_quantile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps_p</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_range</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mu_step</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'cubic'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.generate_mu_of_p_spline_interpolation" title="Link to this definition"></a></dt>
<dd><p>Generates a spline interpolation for mu(p) function for a pre-defined
range of mu, where mu is the mean number of injected signal events and p the
probability for the ts value larger than the ts value corresponding to the
given quantile, h0_ts_quantile, of the null hypothesis test-statistic
distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for the calculation.</p></li>
<li><p><strong>rss</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random numbers.</p></li>
<li><p><strong>h0_ts_vals</strong> (<em>(</em><em>n_h0_ts_vals</em><em>,</em><em>)</em><em>-shaped 1D ndarray</em><em> | </em><em>None</em>) – The 1D ndarray holding the test-statistic values for the
null-hypothesis. If set to <cite>None</cite>, 100/(1-h0_ts_quantile)
null-hypothesis trials will be generated.</p></li>
<li><p><strong>h0_ts_quantile</strong> (<em>float</em>) – Null-hypothesis test statistic quantile, which should be exceeded by
the alternative hypothesis ts value.</p></li>
<li><p><strong>eps_p</strong> (<em>float</em>) – The one sigma precision in <cite>p</cite> as stopping condition for the
calculation for a single mu value.</p></li>
<li><p><strong>mu_range</strong> (<em>2-element sequence</em>) – The range (lower,upper) of mean number of injected signal events to
create the interpolation spline for.</p></li>
<li><p><strong>mu_step</strong> (<em>float</em>) – The step size of the mean number of signal events.</p></li>
<li><p><strong>kind</strong> (<em>str</em>) – The kind of spline to generate. Possble values are ‘linear’ and ‘cubic’
(default).</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>. If <cite>poisson</cite> is set to True, the actual number of
generated signal events will be drawn from a Poisson distribution
with the mean number of signal events, mu.</p></li>
<li><p><strong>ppbar</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.progressbar.ProgressBar" title="skyllh.core.progressbar.ProgressBar"><em>ProgressBar</em></a><em> | </em><em>None</em>) – The possible parent ProgressBar instance.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional TimeLord instance that should be used to collect timing
information about this function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>spline</strong> (<em>callable</em>) – The spline function mu(p).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.create_trial_data_file">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">create_trial_data_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_sig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_sig_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_bkg_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ncpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ppbar</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.create_trial_data_file" title="Link to this definition"></a></dt>
<dd><p>Creates and fills a trial data file with <cite>n_trials</cite> generated trials for
each mean number of injected signal events from <cite>ns_min</cite> up to <cite>ns_max</cite> for
a given analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for the trial generation.</p></li>
<li><p><strong>rss</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random
numbers.</p></li>
<li><p><strong>n_trials</strong> (<em>int</em>) – The number of trials to perform for each hypothesis test.</p></li>
<li><p><strong>mean_n_sig</strong> (<em>ndarray</em><em> of </em><em>float</em><em> | </em><em>float</em><em> | </em><em>2-</em><em> or </em><em>3-element sequence</em><em> of </em><em>float</em>) – The array of mean number of injected signal events (MNOISEs) for which
to generate trials. If this argument is not a ndarray, an array of
MNOISEs is generated based on this argument.
If a single float is given, only this given MNOISEs are injected.
If a 2-element sequence of floats is given, it specifies the range of
MNOISEs with a step size of one.
If a 3-element sequence of floats is given, it specifies the range plus
the step size of the MNOISEs.</p></li>
<li><p><strong>mean_n_sig_null</strong> (<em>ndarray</em><em> of </em><em>float</em><em> | </em><em>float</em><em> | </em><em>2-</em><em> or </em><em>3-element sequence</em><em> of </em><em>float</em>) – The array of the fixed mean number of signal events (FMNOSEs) for the
null-hypothesis for which to generate trials. If this argument is not a
ndarray, an array of FMNOSEs is generated based on this argument.
If a single float is given, only this given FMNOSEs are used.
If a 2-element sequence of floats is given, it specifies the range of
FMNOSEs with a step size of one.
If a 3-element sequence of floats is given, it specifies the range plus
the step size of the FMNOSEs.</p></li>
<li><p><strong>mean_n_bkg_list</strong> (<em>list</em><em> of </em><em>float</em><em> | </em><em>None</em>) – The mean number of background events that should be generated for
each dataset. This parameter is passed to the <code class="docutils literal notranslate"><span class="pre">do_trials</span></code> method of
the <code class="docutils literal notranslate"><span class="pre">Analysis</span></code> class. If set to None (the default), the background
generation method needs to obtain this number itself.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em><em> | </em><em>None</em>) – Trial data file path including the filename.
If set to None generated trials won’t be saved.</p></li>
<li><p><strong>ncpu</strong> (<em>int</em><em> | </em><em>None</em>) – The number of CPUs to use.</p></li>
<li><p><strong>ppbar</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.progressbar.ProgressBar" title="skyllh.core.progressbar.ProgressBar"><em>ProgressBar</em></a><em> | </em><em>None</em>) – The optional instance of the parent progress bar.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The instance of TimeLord that should be used to measure individual
tasks.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>seed</strong> (<em>int</em>) – The seed used to generate the trials.</p></li>
<li><p><strong>mean_n_sig</strong> (<em>1d ndarray</em>) – The array holding the mean number of signal events used to generate the
trials.</p></li>
<li><p><strong>mean_n_sig_null</strong> (<em>1d ndarray</em>) – The array holding the fixed mean number of signal events for the
null-hypothesis used to generate the trials.</p></li>
<li><p><strong>trial_data</strong> (<em>structured numpy ndarray</em>) – The generated trial data.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.extend_trial_data_file">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">extend_trial_data_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_trials</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">trial_data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_sig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_sig_null</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_bkg_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.extend_trial_data_file" title="Link to this definition"></a></dt>
<dd><p>Appends to the trial data file <cite>n_trials</cite> generated trials for each
mean number of injected signal events up to <cite>ns_max</cite> for a given analysis.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for sensitivity estimation.</p></li>
<li><p><strong>rss</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random
numbers.</p></li>
<li><p><strong>n_trials</strong> (<em>int</em>) – The number of trials the trial data file needs to be extended by.</p></li>
<li><p><strong>trial_data</strong> (<em>structured numpy ndarray</em>) – The structured numpy ndarray holding the trials.</p></li>
<li><p><strong>mean_n_sig</strong> (<em>ndarray</em><em> of </em><em>float</em><em> | </em><em>float</em><em> | </em><em>2-</em><em> or </em><em>3-element sequence</em><em> of </em><em>float</em>) – The array of mean number of injected signal events (MNOISEs) for which
to generate trials. If this argument is not a ndarray, an array of
MNOISEs is generated based on this argument.
If a single float is given, only this given MNOISEs are injected.
If a 2-element sequence of floats is given, it specifies the range of
MNOISEs with a step size of one.
If a 3-element sequence of floats is given, it specifies the range plus
the step size of the MNOISEs.</p></li>
<li><p><strong>mean_n_sig_null</strong> (<em>ndarray</em><em> of </em><em>float</em><em> | </em><em>float</em><em> | </em><em>2-</em><em> or </em><em>3-element sequence</em><em> of </em><em>float</em>) – The array of the fixed mean number of signal events (FMNOSEs) for the
null-hypothesis for which to generate trials. If this argument is not a
ndarray, an array of FMNOSEs is generated based on this argument.
If a single float is given, only this given FMNOSEs are used.
If a 2-element sequence of floats is given, it specifies the range of
FMNOSEs with a step size of one.
If a 3-element sequence of floats is given, it specifies the range plus
the step size of the FMNOSEs.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em><em> | </em><em>None</em>) – Trial data file path including the filename.</p></li>
<li><p><strong>arguments</strong> (<em>Additional keyword</em>)</p></li>
<li><p><strong>----------------------------</strong></p></li>
<li><p><strong>create_trial_data_file</strong> (<em>Additional keyword arguments are passed-on to the</em>)</p></li>
<li><p><strong>function.</strong></p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>trial_data</em> – Trial data file extended by the required number of trials for each
mean number of injected signal events..</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.analysis.calculate_upper_limit_distribution">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.analysis.</span></span><span class="sig-name descname"><span class="pre">calculate_upper_limit_distribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pathfilename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bkg</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">5000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_bins</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.analysis.calculate_upper_limit_distribution" title="Link to this definition"></a></dt>
<dd><p>Function to calculate upper limit distribution. It loads the trial data
file containing test statistic distribution and calculates 10 percentile
value for each mean number of injected signal event. Then it finds upper
limit values which correspond to generated background trials test statistic
values by linearly interpolated curve of 10 percentile values distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance to use for sensitivity estimation.</p></li>
<li><p><strong>rss</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random
numbers.</p></li>
<li><p><strong>pathfilename</strong> (<em>string</em>) – Trial data file path including the filename.</p></li>
<li><p><strong>n_bkg</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of times to perform background analysis trial.</p></li>
<li><p><strong>n_bins</strong> (<em>int</em><em>, </em><em>optional</em>) – Number of returned test statistic histograms bins.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>result</strong> (<em>dict</em>) – Result dictionary which contains the following fields:</p>
<dl class="simple">
<dt>ul<span class="classifier">list of float</span></dt><dd><p>List of upper limit values.</p>
</dd>
<dt>mean<span class="classifier">float</span></dt><dd><p>Mean of upper limit values.</p>
</dd>
<dt>median<span class="classifier">float</span></dt><dd><p>Median of upper limit values.</p>
</dd>
<dt>var<span class="classifier">float</span></dt><dd><p>Variance of upper limit values.</p>
</dd>
<dt>ts_hist<span class="classifier">numpy ndarray</span></dt><dd><p>2D array of test statistic histograms calculated by axis 1.</p>
</dd>
<dt>extent<span class="classifier">list of float</span></dt><dd><p>Test statistic histogram boundaries.</p>
</dd>
<dt>q_values<span class="classifier">list of float</span></dt><dd><p><cite>q</cite> percentile values of test statistic for different injected
events means.</p>
</dd>
</dl>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-skyllh.core.utils.coords">
<span id="skyllh-core-utils-coords-module"></span><h2>skyllh.core.utils.coords module<a class="headerlink" href="#module-skyllh.core.utils.coords" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.coords.get_hor_to_equ_transform">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.coords.</span></span><span class="sig-name descname"><span class="pre">get_hor_to_equ_transform</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">detector_model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.coords.get_hor_to_equ_transform" title="Link to this definition"></a></dt>
<dd><p>Returns the hor_to_equ_transform function for the given detector model,
i.e. detector location.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>detector_model</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.model.DetectorModel" title="skyllh.core.model.DetectorModel"><em>DetectorModel</em></a>) – The instance of DetectorModel defining the location of the detector.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>hor_to_equ_transform</strong> (<em>callable</em>) – The transform function to transform horizontal coordinates into
equatorial coordinates. The function has the following call signature:</p>
<blockquote>
<div><p>__call__(azi, alt, mjd)</p>
</div></blockquote>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.coords.rotate_spherical_vector">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.coords.</span></span><span class="sig-name descname"><span class="pre">rotate_spherical_vector</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ra1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec3</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.coords.rotate_spherical_vector" title="Link to this definition"></a></dt>
<dd><p>Calculates the rotation matrix R to rotate the spherical vector
(ra1,dec1) onto the direction (ra2,dec2), and performs this rotation on the
spherical vector (ra3,dec3).</p>
<p>In practice (ra1,dec1) refers to the true location of a MC event,
(ra2,dec2) the true location of the signal source, and (ra3,dec3) the
reconstructed location of the MC event, which should get rotated according
to the rotation of the two true directions.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.coords.rotate_signal_events_on_sphere">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.coords.</span></span><span class="sig-name descname"><span class="pre">rotate_signal_events_on_sphere</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">src_ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">src_dec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evt_true_ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evt_true_dec</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evt_reco_ra</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">evt_reco_dec</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.coords.rotate_signal_events_on_sphere" title="Link to this definition"></a></dt>
<dd><p>Rotate signal events on a sphere to a given source position preserving
position angle and separation (great circle distance) between the event’s
true and reco directions.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>src_ra</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the true right-ascension
of the source.</p></li>
<li><p><strong>src_dec</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the true declination
of the source.</p></li>
<li><p><strong>evt_true_ra</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the true right-ascension
of the MC event.</p></li>
<li><p><strong>evt_true_dec</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the true declination of
the MC event.</p></li>
<li><p><strong>evt_reco_ra</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the reconstructed
right-ascension of the MC event.</p></li>
<li><p><strong>evt_reco_dec</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped 1D numpy.ndarray holding the reconstructed
declination of the MC event.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>rot_evt_reco_ra</strong> (<em>instance of numpy.ndarray</em>) – The (N_events,)-shaped 1D numpy.ndarray holding the rotated
reconstructed event right-ascension.</p></li>
<li><p><strong>rot_evt_reco_dec</strong> (<em>instance of numpy.ndarray</em>) – The (N_events,)-shaped 1D numpy.ndarray holding the rotated
reconstructed event declination.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.coords.angular_separation">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.coords.</span></span><span class="sig-name descname"><span class="pre">angular_separation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ra1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ra2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dec2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">psi_floor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.coords.angular_separation" title="Link to this definition"></a></dt>
<dd><p>Calculates the angular separation on the sphere between two vectors on
the sphere.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ra1</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped numpy.ndarray holding the right-ascension or
longitude coordinate of the first vector in radians.</p></li>
<li><p><strong>dec1</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped numpy.ndarray holding declination or latitude
coordinate of the first vector in radians.</p></li>
<li><p><strong>ra2</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped numpy.ndarray holding the right-ascension or
longitude coordinate of the second vector in radians.</p></li>
<li><p><strong>dec2</strong> (<em>instance</em><em> of </em><a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v2.3)"><em>numpy.ndarray</em></a>) – The (N_events,)-shaped numpy.ndarray holding declination coordinate of
the second vector in radians.</p></li>
<li><p><strong>psi_floor</strong> (<em>float</em><em> | </em><em>None</em>) – If not <code class="docutils literal notranslate"><span class="pre">None</span></code>, specifies the floor value of psi.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>psi</strong> (<em>instance of numpy.ndarray</em>) – The (N_events,)-shaped numpy.ndarray holding the calculated angular
separation value of each event.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-skyllh.core.utils.flux_model">
<span id="skyllh-core-utils-flux-model-module"></span><h2>skyllh.core.utils.flux_model module<a class="headerlink" href="#module-skyllh.core.utils.flux_model" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.flux_model.create_scipy_stats_rv_continuous_from_TimeFluxProfile">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.flux_model.</span></span><span class="sig-name descname"><span class="pre">create_scipy_stats_rv_continuous_from_TimeFluxProfile</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">profile</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.flux_model.create_scipy_stats_rv_continuous_from_TimeFluxProfile" title="Link to this definition"></a></dt>
<dd><p>This function builds a scipy.stats.rv_continuous instance for a given
<a class="reference internal" href="skyllh.core.html#skyllh.core.flux_model.TimeFluxProfile" title="skyllh.core.flux_model.TimeFluxProfile"><code class="xref py py-class docutils literal notranslate"><span class="pre">TimeFluxProfile</span></code></a> instance.</p>
<p>It can be used to generate random numbers according to the given time flux
profile function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>profile</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.flux_model.TimeFluxProfile" title="skyllh.core.flux_model.TimeFluxProfile"><em>TimeFluxProfile</em></a>) – The instance of TimeFluxProfile providing the function of the time flux
profile.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>rv</strong> (<em>instance of rv_continuous_frozen</em>) – The instance of rv_continuous_frozen representing the time flux profile
as a continuous random variate instance.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-skyllh.core.utils.multidimgridpdf">
<span id="skyllh-core-utils-multidimgridpdf-module"></span><h2>skyllh.core.utils.multidimgridpdf module<a class="headerlink" href="#module-skyllh.core.utils.multidimgridpdf" title="Link to this heading"></a></h2>
<p>This module contains utility functions for creating and managing
MultiDimGridPDF instances.</p>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.multidimgridpdf.get_kde_pdf_sig_spatial_norm_factor_func">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.multidimgridpdf.</span></span><span class="sig-name descname"><span class="pre">get_kde_pdf_sig_spatial_norm_factor_func</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">log10_psi_name</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'log10_psi'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.multidimgridpdf.get_kde_pdf_sig_spatial_norm_factor_func" title="Link to this definition"></a></dt>
<dd><p>Returns the standard normalization factor function for the spatial
signal MultiDimGridPDF, which is created from KDE PDF values.
It can be used for the <code class="docutils literal notranslate"><span class="pre">norm_factor_func</span></code> argument of the
<code class="docutils literal notranslate"><span class="pre">create_MultiDimGridPDF_from_photosplinetable</span></code> and
<code class="docutils literal notranslate"><span class="pre">create_MultiDimGridPDF_from_kde_pdf</span></code> function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>log10_psi_name</strong> (<em>str</em>) – The name of the event data field for the log10(psi) values.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.multidimgridpdf.get_kde_pdf_bkg_norm_factor_func">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.multidimgridpdf.</span></span><span class="sig-name descname"><span class="pre">get_kde_pdf_bkg_norm_factor_func</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.multidimgridpdf.get_kde_pdf_bkg_norm_factor_func" title="Link to this definition"></a></dt>
<dd><p>Returns the standard normalization factor function for the background
MultiDimGridPDF, which is created from KDE PDF values.
It can be used for the <code class="docutils literal notranslate"><span class="pre">norm_factor_func</span></code> argument of the
<code class="docutils literal notranslate"><span class="pre">create_MultiDimGridPDF_from_photosplinetable</span></code> and
<code class="docutils literal notranslate"><span class="pre">create_MultiDimGridPDF_from_kde_pdf</span></code> function.</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.multidimgridpdf.create_MultiDimGridPDF_from_photosplinetable">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.multidimgridpdf.</span></span><span class="sig-name descname"><span class="pre">create_MultiDimGridPDF_from_photosplinetable</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">multidimgridpdf_cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pmm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">info_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">splinetable_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kde_pdf_axis_name_map_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'KDE_PDF_axis_name_map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_factor_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_pd_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.multidimgridpdf.create_MultiDimGridPDF_from_photosplinetable" title="Link to this definition"></a></dt>
<dd><p>Creates a MultiDimGridPDF instance with pdf values taken from a photospline
pdf, i.e. a spline interpolation of KDE PDF values stored in a splinetable
on disk.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>multidimgridpdf_cls</strong> (<em>subclass</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.pdf.MultiDimGridPDF" title="skyllh.core.pdf.MultiDimGridPDF"><em>MultiDimGridPDF</em></a>) – The MultiDimGridPDF class, which should be used.</p></li>
<li><p><strong>pmm</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.parameters.ParameterModelMapper" title="skyllh.core.parameters.ParameterModelMapper"><em>ParameterModelMapper</em></a>) – The instance of ParameterModelMapper, which defines the mapping of
global parameters to local model parameters.</p></li>
<li><p><strong>ds</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.dataset.Dataset" title="skyllh.core.dataset.Dataset"><em>Dataset</em></a>) – The instance of Dataset the PDF applies to.</p></li>
<li><p><strong>data</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.dataset.DatasetData" title="skyllh.core.dataset.DatasetData"><em>DatasetData</em></a>) – The instance of DatasetData that holds the experimental and monte-carlo
data of the dataset.</p></li>
<li><p><strong>info_key</strong> (<em>str</em>) – The auxiliary data name for the file containing PDF information.</p></li>
<li><p><strong>splinetable_key</strong> (<em>str</em>) – The auxiliary data name for the name of the file containing the
photospline spline table.</p></li>
<li><p><strong>kde_pdf_axis_name_map_key</strong> (<em>str</em>) – The auxiliary data name for the KDE PDF axis name map.</p></li>
<li><p><strong>norm_factor_func</strong> (<em>callable</em><em> | </em><em>None</em>) – The function that calculates a possible required normalization
factor for the PDF value based on the event properties.
For more information about this argument see the documentation of the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">skyllh.core.pdf.MultiDimGridPDF.__init__()</span></code> method.</p></li>
<li><p><strong>cache_pd_values</strong> (<em>bool</em>) – Flag if the probability density values should get cached by the
MultiDimGridPDF class.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional instance of TimeLord to use for measuring timing
information.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>pdf</strong> (instance of <code class="docutils literal notranslate"><span class="pre">multidimgridpdf_cls</span></code>) – The created PDF instance of MultiDimGridPDF.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.multidimgridpdf.create_MultiDimGridPDF_from_kde_pdf">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.multidimgridpdf.</span></span><span class="sig-name descname"><span class="pre">create_MultiDimGridPDF_from_kde_pdf</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">multidimgridpdf_cls</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pmm</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">numerator_key</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">denumerator_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kde_pdf_axis_name_map_key</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'KDE_PDF_axis_name_map'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">norm_factor_func</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cache_pd_values</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.multidimgridpdf.create_MultiDimGridPDF_from_kde_pdf" title="Link to this definition"></a></dt>
<dd><p>Creates a MultiDimGridPDF instance with pdf values taken from KDE PDF
values stored in the dataset’s auxiliary data.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>multidimgridpdf_cls</strong> (<em>subclass</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.pdf.MultiDimGridPDF" title="skyllh.core.pdf.MultiDimGridPDF"><em>MultiDimGridPDF</em></a>) – The MultiDimGridPDF class, which should be used.</p></li>
<li><p><strong>pmm</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.parameters.ParameterModelMapper" title="skyllh.core.parameters.ParameterModelMapper"><em>ParameterModelMapper</em></a>) – The instance of ParameterModelMapper, which defines the mapping of
global parameters to local model parameters.</p></li>
<li><p><strong>ds</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.dataset.Dataset" title="skyllh.core.dataset.Dataset"><em>Dataset</em></a>) – The instance of Dataset the PDF applies to.</p></li>
<li><p><strong>data</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.dataset.DatasetData" title="skyllh.core.dataset.DatasetData"><em>DatasetData</em></a>) – The instance of DatasetData that holds the auxiliary data of the
dataset.</p></li>
<li><p><strong>numerator_key</strong> (<em>str</em>) – The auxiliary data name for the PDF numerator array.</p></li>
<li><p><strong>denumerator_key</strong> (<em>str</em><em> | </em><em>None</em>) – The auxiliary data name for the PDF denumerator array.
This can be <code class="docutils literal notranslate"><span class="pre">None</span></code>, if no denumerator array is required.</p></li>
<li><p><strong>kde_pdf_axis_name_map_key</strong> (<em>str</em>) – The auxiliary data name for the KDE PDF axis name map.</p></li>
<li><p><strong>norm_factor_func</strong> (<em>callable</em><em> | </em><em>None</em>) – The function that calculates a possible required normalization
factor for the PDF value based on the event properties.
For more information about this argument see the documentation of the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">skyllh.core.pdf.MultiDimGridPDF.__init__()</span></code> method.</p></li>
<li><p><strong>cache_pd_values</strong> (<em>bool</em>) – Flag if the probability density values should get cached by the
MultiDimGridPDF class.</p></li>
<li><p><strong>tl</strong> (<em>instance</em><em> of </em><a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The optional instance of TimeLord to use for measuring timing
information.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>pdf</strong> (instance of <code class="docutils literal notranslate"><span class="pre">multidimgridpdf_cls</span></code>) – The created PDF instance of MultiDimGridPDF.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-skyllh.core.utils.spline">
<span id="skyllh-core-utils-spline-module"></span><h2>skyllh.core.utils.spline module<a class="headerlink" href="#module-skyllh.core.utils.spline" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.spline.make_spline_1d">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.spline.</span></span><span class="sig-name descname"><span class="pre">make_spline_1d</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'linear'</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.spline.make_spline_1d" title="Link to this definition"></a></dt>
<dd><p>Creates a 1D spline for the function y(x) using
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d" title="(in SciPy v1.16.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.interpolate.interp1d</span></code></a>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>array_like</em>) – The x values.</p></li>
<li><p><strong>y</strong> (<em>array_like</em>) – The y values.</p></li>
<li><p><strong>kind</strong> (<em>str</em>) – The kind of the spline. See the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d" title="(in SciPy v1.16.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">scipy.interpolate.interp1d</span></code></a>
documentation for possible values. Default is <code class="docutils literal notranslate"><span class="pre">'linear'</span></code>.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments are passed to the <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.interpolate.interp1d.html#scipy.interpolate.interp1d" title="(in SciPy v1.16.2)"><code class="xref py py-class docutils literal notranslate"><span class="pre">interp1d</span></code></a> function.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><em>spline</em> – The created 1D spline instance.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="skyllh.core.utils.spline.CatmullRomRegular1DSpline">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.spline.</span></span><span class="sig-name descname"><span class="pre">CatmullRomRegular1DSpline</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.spline.CatmullRomRegular1DSpline" title="Link to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>This class provides a one-dimensional Catmull-Rom spline which is a C^1
continous spline, where the control points coincide with the data points.
The x data points need to be equal distant.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first and last data point are not part of the splined curve!</p>
</div>
<p>Creates a new CatmullRom1DSpline instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<em>instance</em><em> of </em><em>ndarray</em>) – The x values of the data points.</p></li>
<li><p><strong>y</strong> (<em>instance</em><em> of </em><em>ndarray</em>) – The y values of the data points.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="skyllh.core.utils.spline.CatmullRomRegular1DSpline.__call__">
<span class="sig-name descname"><span class="pre">__call__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">oor_value</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">nan</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.spline.CatmullRomRegular1DSpline.__call__" title="Link to this definition"></a></dt>
<dd><p>Evaluates the spline given x-values in data coordinates.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>x</strong> (<em>instance</em><em> of </em><em>ndarray</em>) – The instance of ndarray holding the values for which the spline
should get evaluated.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>y</strong> (<em>instance of ndarray</em>) – The instance of ndarray with the spline values at the given x
values.</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="skyllh.core.utils.spline.CatmullRomRegular1DSpline.__firstlineno__">
<span class="sig-name descname"><span class="pre">__firstlineno__</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">56</span></em><a class="headerlink" href="#skyllh.core.utils.spline.CatmullRomRegular1DSpline.__firstlineno__" title="Link to this definition"></a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="skyllh.core.utils.spline.CatmullRomRegular1DSpline.__static_attributes__">
<span class="sig-name descname"><span class="pre">__static_attributes__</span></span><em class="property"><span class="w"> </span><span class="p"><span class="pre">=</span></span><span class="w"> </span><span class="pre">('_delta_x',</span> <span class="pre">'_num_segments',</span> <span class="pre">'_segment_data',</span> <span class="pre">'_x_start',</span> <span class="pre">'_x_stop')</span></em><a class="headerlink" href="#skyllh.core.utils.spline.CatmullRomRegular1DSpline.__static_attributes__" title="Link to this definition"></a></dt>
<dd></dd></dl>

</dd></dl>

</section>
<section id="module-skyllh.core.utils.tdm">
<span id="skyllh-core-utils-tdm-module"></span><h2>skyllh.core.utils.tdm module<a class="headerlink" href="#module-skyllh.core.utils.tdm" title="Link to this heading"></a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.tdm.get_tdm_field_func_psi">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.tdm.</span></span><span class="sig-name descname"><span class="pre">get_tdm_field_func_psi</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">psi_floor</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.tdm.get_tdm_field_func_psi" title="Link to this definition"></a></dt>
<dd><p>Returns the TrialDataManager (TDM) field function for psi with an
optional psi value floor.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>psi_floor</strong> (<em>float</em><em> | </em><em>None</em>) – The optional floor value for psi. This should be <code class="docutils literal notranslate"><span class="pre">None</span></code> for a standard
point-source analysis that uses an analytic function for the detector’s
point-spread-function (PSF).</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>tdm_field_func_psi</strong> (<em>function</em>) – TrialDataManager (TDM) field function for psi.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-skyllh.core.utils.trials">
<span id="skyllh-core-utils-trials-module"></span><h2>skyllh.core.utils.trials module<a class="headerlink" href="#module-skyllh.core.utils.trials" title="Link to this heading"></a></h2>
<p>This module contains utility functions related analysis trials.</p>
<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.trials.create_pseudo_data_file">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.trials.</span></span><span class="sig-name descname"><span class="pre">create_pseudo_data_file</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">ana</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rss</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_bkg_list</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mean_n_sig</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bkg_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sig_kwargs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.trials.create_pseudo_data_file" title="Link to this definition"></a></dt>
<dd><p>Creates a pickle file that contains the pseudo data for a single trial
by generating background and signal events.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ana</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.analysis.Analysis" title="skyllh.core.analysis.Analysis"><em>Analysis</em></a>) – The Analysis instance that should be used to generate the pseudo data.</p></li>
<li><p><strong>rss</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.random.RandomStateService" title="skyllh.core.random.RandomStateService"><em>RandomStateService</em></a>) – The RandomStateService instance to use for generating random numbers.</p></li>
<li><p><strong>filename</strong> (<em>str</em>) – The data file name into which the generated pseudo data should get
written to.</p></li>
<li><p><strong>mean_n_bkg_list</strong> (<em>list</em><em> of </em><em>float</em><em> | </em><em>None</em>) – The mean number of background events that should be generated for
each dataset. If set to None (the default), the background
generation method needs to obtain this number itself.</p></li>
<li><p><strong>mean_n_sig</strong> (<em>float</em>) – The mean number of signal events that should be generated for the
trial. The actual number of generated events will be drawn from a
Poisson distribution with this given signal mean as mean.</p></li>
<li><p><strong>bkg_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_events</cite> method of the
background generation method class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>sig_kwargs</strong> (<em>dict</em><em> | </em><em>None</em>) – Additional keyword arguments for the <cite>generate_signal_events</cite> method
of the <cite>SignalGenerator</cite> class. An usual keyword argument is
<cite>poisson</cite>.</p></li>
<li><p><strong>tl</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The instance of TimeLord that should be used to time individual tasks.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="skyllh.core.utils.trials.load_pseudo_data">
<span class="sig-prename descclassname"><span class="pre">skyllh.core.utils.trials.</span></span><span class="sig-name descname"><span class="pre">load_pseudo_data</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tl</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#skyllh.core.utils.trials.load_pseudo_data" title="Link to this definition"></a></dt>
<dd><p>Loads the pseudo data for a single trial from the given file name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>filename</strong> (<em>str</em>) – The name of the file that contains the pseudo data.</p></li>
<li><p><strong>tl</strong> (<a class="reference internal" href="skyllh.core.html#skyllh.core.timing.TimeLord" title="skyllh.core.timing.TimeLord"><em>TimeLord</em></a><em> | </em><em>None</em>) – The instance of TimeLord that should be used to time individual tasks.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>mean_n_sig</strong> (<em>float</em>) – The mean number of signal events that was used to generate the pseudo
data.</p></li>
<li><p><strong>n_sig</strong> (<em>int</em>) – The actual total number of signal events in the pseudo data.</p></li>
<li><p><strong>n_bkg_events_list</strong> (<em>list of int</em>) – The total number of background events for each data set of the
pseudo data.</p></li>
<li><p><strong>n_sig_events_list</strong> (<em>list of int</em>) – The total number of signal events for each data set of the pseudo data.</p></li>
<li><p><strong>bkg_events_list</strong> (<em>list of DataFieldRecordArray instances</em>) – The list of DataFieldRecordArray instances containing the background
pseudo data events for each data set.</p></li>
<li><p><strong>sig_events_list</strong> (<em>list of DataFieldRecordArray instances | None</em>) – The list of DataFieldRecordArray instances containing the signal
pseudo data events for each data set. If a particular dataset has
no signal events, the entry for that dataset can be None.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="skyllh.core.minimizers.html" class="btn btn-neutral float-left" title="skyllh.core.minimizers package" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="skyllh.datasets.html" class="btn btn-neutral float-right" title="skyllh.datasets package" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, The IceCube Collaboration, T. Kontrimas, M. Wolf.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: coords
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../../master/html/index.html">master</a></dd>
      <dd><a href="skyllh.core.utils.html">coords</a></dd>
      <dd><a href="../../../data_release/html/index.html">data_release</a></dd>
      <dd><a href="../../../dm/html/index.html">dm</a></dd>
      <dd><a href="../../../fix169_fix203/html/index.html">fix169_fix203</a></dd>
      <dd><a href="../../../fix230/html/index.html">fix230</a></dd>
      <dd><a href="../../../llh_module/html/index.html">llh_module</a></dd>
      <dd><a href="../../../signal_gen_method/html/index.html">signal_gen_method</a></dd>
      <dd><a href="../../../stack_public/html/index.html">stack_public</a></dd>
    </dl>
    <dl>
      <dt>Tags</dt>
      <dd><a href="../../../v19_09_15/html/index.html">v19_09_15</a></dd>
      <dd><a href="../../../v20_01_09/html/index.html">v20_01_09</a></dd>
      <dd><a href="../../../v20_03_12/html/index.html">v20_03_12</a></dd>
      <dd><a href="../../../v20_11_02/html/index.html">v20_11_02</a></dd>
      <dd><a href="../../../v21_10_18_temp/html/index.html">v21_10_18_temp</a></dd>
      <dd><a href="../../../v21_10_20/html/index.html">v21_10_20</a></dd>
      <dd><a href="../../../v22_04_28/html/index.html">v22_04_28</a></dd>
      <dd><a href="../../../v22_04_28a/html/index.html">v22_04_28a</a></dd>
      <dd><a href="../../../v23.0.0/html/index.html">v23.0.0</a></dd>
      <dd><a href="../../../v23.1.0/html/index.html">v23.1.0</a></dd>
      <dd><a href="../../../v23.1.1/html/index.html">v23.1.1</a></dd>
      <dd><a href="../../../v23.2.0/html/index.html">v23.2.0</a></dd>
      <dd><a href="../../../v23.2.1/html/index.html">v23.2.1</a></dd>
      <dd><a href="../../../v23.2.1.rc1/html/index.html">v23.2.1.rc1</a></dd>
      <dd><a href="../../../v24.1.0/html/index.html">v24.1.0</a></dd>
      <dd><a href="../../../v24.1.1a/html/index.html">v24.1.1a</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>